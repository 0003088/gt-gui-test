Name:          elektra
Version:       @VERSION@
%define myRelease 1
%define vepoch 1
Release:       0.fdr.%{vepoch}.%{myRelease}
Source:        http://aleron.dl.sourceforge.net/sourceforge/elektra/%{name}-%{version}.tar.gz
Group:         System Environment/Libraries
License:       BSD
URL:           http://www.libelektra.org
BuildRoot:     %{_tmppath}/%{name}-%{version}-build
BuildRequires: doxygen docbook-style-xsl db4-devel GConf2-devel libxml2-devel gettext-devel automake autoconf libtool /usr/bin/xsltproc
Summary:       A key/value pair database to store software configurations

%define DTDVERSION 0.1.1

# A buggy version of rpmbuild
%define _sysconfdir /etc

%description
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

%package devel
Summary:      Include files and API documentation for Elektra Project
Group:        Development/System
Requires:     elektra = %{version}-%{release}

%description devel
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

This Package contains devel parts.


%package backend-gconf
Summary:      A GConf backend for Elektra
Group:        System Environment/Libraries
Requires:     elektra


%description backend-gconf
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

This package contains a GConf backend for Elektra, to let Elektra use a GConf
daemon to store its keys.


%package backend-berkeleydb
Summary:      Include files and API documentation for Elektra Project
Group:        System Environment/Libraries
Requires:     elektra


%description backend-berkeleydb
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

This package contains a Berkeley DB backend for Elektra, to let Elektra use
Berkeley DB databases to store its keys.


%prep
%setup
%build
# Setup for parallel builds
numprocs=`egrep -c ^cpu[0-9]+ /proc/stat || :`
if [ "$numprocs" = "0" ]; then
	numprocs=1
fi

./configure \
     --prefix=/usr \
     --exec-prefix=/ \
     --mandir=/usr/share/man \
     --sysconfdir=/etc \
     --disable-xmltest \
     --with-docbook=/usr/share/sgml/docbook/xsl-stylesheets

make all

#gmake OPTIMIZATIONS="$RPM_OPT_FLAGS" \
#	%{?_smp_mflags} \
#	UBINDIR=%{_bindir} \
#	ULIBDIR=%{_libdir} \
#	CONFDIR=%{_sysconfdir} \
#	INCDIR=%{_includedir} \
#	DOCDIR=%{_docdir} \
#	MANDIR=%{_mandir} \
#	SGMLDIR=%{_datadir}/sgml \
#	all

%install
rm -rf $RPM_BUILD_ROOT

make DESTDIR=$RPM_BUILD_ROOT install

rm $RPM_BUILD_ROOT/lib/libelektra-*.a
rm $RPM_BUILD_ROOT/lib/libregistry*.a
mv $RPM_BUILD_ROOT/lib/libelektra.a $RPM_BUILD_ROOT/usr/lib
 
rm $RPM_BUILD_ROOT/usr/lib/libelektra-*.a
rm $RPM_BUILD_ROOT/lib/*.la
rm $RPM_BUILD_ROOT/usr/lib/*.la
 
#gmake  %{?_smp_mflags} \
#	DESTDIR=$RPM_BUILD_ROOT \
#	UBINDIR=%{_bindir} \
#	ULIBDIR=%{_libdir} \
#	CONFDIR=%{_sysconfdir} \
#	INCDIR=%{_includedir} \
#	DOCDIR=%{_docdir} \
#	MANDIR=%{_mandir} \
#	SGMLDIR=%{_datadir}/sgml \
#	install

%clean
rm -rf $RPM_BUILD_ROOT
#rm -rf $RPM_BUILD_DIR/%{name}




%post
/sbin/ldconfig
# Backwards compatibility, from the Linux Registry days
if [ -d /etc/registry -a ! -d /etc/kdb ]; then
	mv /etc/registry /etc/kdb
	ln -s kdb /etc/registry
fi

# Create basic key structure for apps
kdb set -t dir system/sw
kdb set system/sw/kdb/current/schemapath "%{_datadir}/sgml/elektra-%{DTDVERSION}/elektra.xsd"


%postun -p /sbin/ldconfig



%files
%defattr(-,root,root,0755)
/lib/*elektra.so*
/lib/*registry.so*
/lib/*elektra-filesys.so*
/lib/*elektra-default.so*
/lib/*elektra-fstab.so*
/lib/*elektra-ini.so*
%{_libdir}/*elektratools.so*
/bin/*
%{_sysconfdir}/profile.d/*
%doc %{_docdir}/%{name}
%doc %{_mandir}/man1/*
%doc %{_mandir}/man7/*
%doc %{_mandir}/man5/*
%{_datadir}/sgml/*



%files devel
%defattr(-,root,root,0755)
%{_includedir}/*
%{_libdir}/*.a
#%{_libdir}/pkgconfig/*
%doc %{_docdir}/%{name}-devel
%doc %{_mandir}/man3/*



%files backend-gconf
%defattr(-,root,root,0755)
%{_libdir}/*gconf.so*

%files backend-berkeleydb
%defattr(-,root,root,0755)
/lib/*berkeleydb.so*



%changelog
