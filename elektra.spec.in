Name:          elektra
Version:       @VERSION@
Release:       1
Source:        http://aleron.dl.sourceforge.net/sourceforge/elektra/%{name}-%{version}.tar.gz
Group:         System Environment/Libraries
License:       BSD
URL:           http://www.libelektra.org
Requires:      libxml2
BuildRoot:     %{_tmppath}/%{name}-%{version}-%{release}-root-%(%{__id_u} -n)
BuildRequires: doxygen docbook-style-xsl db4-devel libxml2-devel gettext-devel automake autoconf libtool libxslt #GConf2-devel
Summary:       A key/value pair database to store software configurations

%define DTDVERSION 0.1.1

%description
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

%package devel
Summary:      Include files and API documentation for Elektra Project
Group:        Development/System
Requires:     elektra = %{version}-%{release}

%description devel
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

This Package contains development specific things as include files and
static libraries.


#%package backend-gconf
#Summary:      A GConf backend for Elektra
#Group:        System Environment/Libraries
#Requires:     elektra GConf2


#%description backend-gconf
#Elektra provides a universal and secure framework to store configuration
#parameters in a hierarchical key-value pair mechanism, instead of each
#program using its own text configuration files. This allows any program
#to read and save its configuration with a consistent API, and allows
#them to be aware of other applications' configurations, permitting
#easy application integration. While architecturally similar to other OS
#registries, Elektra does not have most of the problems found in those
#implementations.

#This package contains a GConf backend for Elektra, to let Elektra use a GConf
#daemon to store its keys.


%package backend-berkeleydb
Summary:      Include files and API documentation for Elektra Project
Group:        System Environment/Libraries
Requires:     elektra db4


%description backend-berkeleydb
Elektra provides a universal and secure framework to store configuration
parameters in a hierarchical key-value pair mechanism, instead of each
program using its own text configuration files. This allows any program
to read and save its configuration with a consistent API, and allows
them to be aware of other applications' configurations, permitting
easy application integration. While architecturally similar to other OS
registries, Elektra does not have most of the problems found in those
implementations.

This package contains a Berkeley DB backend for Elektra, to let Elektra use
Berkeley DB databases to store its keys.

# Uncomment and joint the '%' char to 'debug_package' if you want to build debug RPMs
# % debug_package

%prep
%setup
%build
# Setup for parallel builds
numprocs=`egrep -c ^cpu[0-9]+ /proc/stat || :`
if [ "$numprocs" = "0" ]; then
	numprocs=1
fi

./configure \
     --prefix=/usr \
     --exec-prefix=/ \
     --mandir=%{_mandir} \
     --sysconfdir=%{_sysconfdir} \
     --disable-xmltest \
     --with-docbook=/usr/share/sgml/docbook/xsl-stylesheets

make all


%install
rm -rf $RPM_BUILD_ROOT

make DESTDIR=$RPM_BUILD_ROOT install

rm $RPM_BUILD_ROOT/lib/libelektra-*.a
mv $RPM_BUILD_ROOT/lib/libelektra.a $RPM_BUILD_ROOT/usr/lib
 
#rm $RPM_BUILD_ROOT/usr/lib/libelektra-*.a
rm $RPM_BUILD_ROOT/lib/*.la
rm $RPM_BUILD_ROOT/usr/lib/*.la
 

%clean
#rm -rf $RPM_BUILD_ROOT
rm -rf $RPM_BUILD_DIR/%{name}




%post
/sbin/ldconfig
# Backwards compatibility, from the Linux Registry days
if [ -d /etc/registry -a ! -d /etc/kdb ]; then
	mv /etc/registry /etc/kdb
	ln -s kdb /etc/registry
fi

# Create basic key structure for apps
kdb set -t dir system/sw
kdb set system/sw/kdb/current/schemapath "%{_datadir}/sgml/elektra-%{DTDVERSION}/elektra.xsd"


%postun -p /sbin/ldconfig



%files
%defattr(-,root,root,0755)
/lib/*elektra.so*
#/lib/*registry.so*
/lib/*elektra-filesys.so*
/lib/*elektra-default.so*
/lib/*elektra-fstab.so*
#/lib/*elektra-ini.so*
%{_libdir}/*elektratools.so*
/bin/*
%{_sysconfdir}/profile.d/*
%doc %{_docdir}/%{name}
%doc %{_mandir}/man1/*
%doc %{_mandir}/man7/*
%doc %{_mandir}/man5/*
%{_datadir}/sgml/*



%files devel
%defattr(-,root,root,0755)
%{_includedir}/*
%{_libdir}/*.a
%{_libdir}/pkgconfig/*
%doc %{_docdir}/%{name}-devel
%doc %{_mandir}/man3/*



#%files backend-gconf
#%defattr(-,root,root,0755)
#%{_libdir}/*gconf.so*

%files backend-berkeleydb
%defattr(-,root,root,0755)
/lib/*berkeleydb.so*



%changelog
