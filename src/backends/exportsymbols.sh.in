#!/bin/sh -x

# exportsymbols.sh
# ----------------
#
# Export kdbBackendFactory entry point symbols
# for each compiled backend
#
# (c) 2006 Yannick Lecaillez

echo '
/* backend_symbols.c generated by exportsymbols.sh */

#include "kdbbackend.h"
#include "kdbLibLoader.h"

/* Make the compiler happy */
' > backend_symbols.c

for dir in "$@"
do
	if [ -r $dir/libelektra-$dir.a ]; then
		echo "Exporting symbols for $dir ..."
		echo "extern int libelektra_"$dir"_LTX_kdbBackendFactory;" >> backend_symbols.c
	fi
done

echo '
kdblib_symbol kdb_exported_syms[] =
{
' >> backend_symbols.c

for dir in "$@"
do
	if [ -r $dir/libelektra-$dir.a ]; then
		echo -e "\t{\"libelektra-$dir\", NULL}," >> backend_symbols.c
		sym=`@NM@ -B $dir/libelektra-$dir.a | @EGREP@ "_LTX_" | @AWK@ '{print $3}'`
		echo -e "\t{\"kdbBackendFactory\", &$sym },\n" >> backend_symbols.c
	fi
done
echo -e "\t{ NULL, NULL }" >> backend_symbols.c
echo "};" >> backend_symbols.c
	
