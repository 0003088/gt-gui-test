<div class="section">
	<h1>Elektrified /sbin/init</h1>

	<p>Instead of reading its actions from /etc/inittab, it can now work with a
	configuration tree under system/init on the Elektra (http://elektra.sf.net)
	key/value pair database.</p>

	<p>So where you once had human-readable inittab entries like</p>

	<pre class="screen">
	
	13:3:wait:/etc/rc.d/rc 3
	ca::ctrlaltdel:/sbin/shutdown -t3 -r now
	2:2345:respawn:/sbin/mingetty tty2
	x:5:respawn:/etc/X11/prefdm -nodaemon
	</pre>

	<p>you'll have the equivalent human-and-machine-readable Elektra keys:</p>

	<pre class="screen">

	system/init/l3/action=wait
	system/init/l3/process=/etc/rc.d/rc 3
	system/init/l3/runlevels=3

	system/init/ca/action=ctrlaltdel
	system/init/ca/process=/sbin/shutdown -t3 -r now
	system/init/ca/runlevels=

	system/init/2/action=respawn
	system/init/2/process=/sbin/mingetty tty2
	system/init/2/runlevels=2345

	system/init/x/action=respawn
	system/init/x/process=/etc/X11/prefdm -nodaemon
	system/init/x/runlevels=5

	system/init/sequence=...,l3,ca,2,x,...
	</pre>


	<p>Then, to change some value you wont have to manually edit
	/etc/inittab anymore. You (or a program using Elektra API), with root
	permissions, will be able to use the kdb command or regedit GUI tool to
	change each single key. So to change your default run level to 5,
	you'll do:</p>

	<pre class="screen">

	bash# kdb set system/init/id/runlevels 5
	</pre>

	<p>The patch was carefully written, so if the elektrified /sbin/init does not
	find its configuration keys under system/init, it will default to the old
	method (use /etc/inittab) and you'll see warnings on the screen about it.</p>

	<h2>Compiling SysVinit package with the elektra patch</h2>

	<p>You'll obviously need Elektra installed to compile it, and you can
	get it from http://elektra.sf.net, as source code or binray RPMs or debs.
	If the the original distribution of SysVinit, from Miquel van Smoorenburg,
	does not already contain the patch, you can get it also
	from http://elektra.sf.net</p>

	<p>So if needed, apply the patch:</p>

	<pre class="screen">

	bash$ tar -zxvf sysvinit-2.85.tar.gz
	bash$ cd sysvinit-2.85
	bash$ patch -p 1 -b < ../sysvinit-2.85-elektra.patch
	</pre>

	<p>These modifications only affect the init binary, since this is the only
	program in the package that reads /etc/inittab.</p>

	<p>To compile it, youll have to use a special make flag like this:</p>

	<pre class="screen">

	bash$ make ELEKTRA=1
	</pre>

	<p>otherwise you'll get a non-elektrified init binary, exactly the way it was
	before applying the patch.</p>

	<p>After compiling you can check it and see these results:</p>

	<pre class="screen">

	bash$ ldd ./init
	libkdb.so => /lib/libkdb.so (0xb75d8000)
        libc.so.6 => /lib/tls/libc.so.6 (0xb749f000)
	/lib/ld-linux.so.2 => /lib/ld-linux.so.2 (0xb75eb000)
	</pre>

	<p>Now the init binary requires libkdb.so, which is the Elektra library.</p>

	<h2>Migrating /etc/inittab to elektra keys</h2>

	<p>A script is provided for you to convert your old /etc/inittab to
	Elektra keys. To use it you'll need root permissions:</p>

	<pre class="screen">

	bash# inittab-convert | sh -e
	</pre>

	<p>After doing this, and installing the "elektrified" version of init in /sbin,
	you can reboot your machine too see it booting.</p>

	<p>You can see what the script does, without actually doing it, executing:</p>

	<pre class="screen">

	bash$ inittab-convert
	</pre>

	<p>and you don't need root permissions for that.</p>

	<p>Enjoy,<br>
	Avi Alkalay<br>
	The Elektra Project<br>
	Sep 1, 2004
	</p>
</div>
